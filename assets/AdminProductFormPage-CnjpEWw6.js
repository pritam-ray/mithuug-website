import{c as B,r as b,j as e,x as A,X as L,s as k,q as M,k as z,v as D}from"./index-DDPWc_ZQ.js";import{U as $}from"./upload-CZVShtMT.js";import{A as R}from"./arrow-left-BOFrSrdS.js";import{S as T}from"./save-Sf0pIYD6.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=B("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=B("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),V=({images:n,onImagesChange:h,maxImages:m=5,maxSizeMB:v=2})=>{const[s,o]=b.useState(!1),[P,N]=b.useState(null),y=b.useRef(null),I=(i,a)=>new Promise((c,g)=>{const d=new FileReader;d.readAsDataURL(i),d.onload=j=>{var f;const u=new Image;u.src=(f=j.target)==null?void 0:f.result,u.onload=()=>{const w=document.createElement("canvas");let x=u.width,p=u.height;const t=1920;x>p&&x>t?(p=p*t/x,x=t):p>t&&(x=x*t/p,p=t),w.width=x,w.height=p;const r=w.getContext("2d");if(!r){g(new Error("Failed to get canvas context"));return}r.drawImage(u,0,0,x,p);let l=.9;const q=()=>{w.toBlob(E=>{if(!E){g(new Error("Failed to compress image"));return}if(E.size/1024/1024>a&&l>.1)l-=.1,q();else{const U=new File([E],i.name,{type:"image/jpeg",lastModified:Date.now()});c(U)}},"image/jpeg",l)};q()},u.onerror=()=>g(new Error("Failed to load image"))},d.onerror=()=>g(new Error("Failed to read file"))}),_=async i=>{try{const a=await I(i,v),c=i.name.split(".").pop(),d=`products/${`${Math.random().toString(36).substring(2)}-${Date.now()}.${c}`}`,{data:j,error:u}=await k.storage.from("product-images").upload(d,a,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:{publicUrl:f}}=k.storage.from("product-images").getPublicUrl(j.path);return f}catch(a){throw console.error("Error uploading image:",a),a}},S=async i=>{const a=i.target.files;if(!(!a||a.length===0)){if(n.length+a.length>m){N(`Maximum ${m} images allowed`);return}o(!0),N(null);try{const c=Array.from(a).map(d=>_(d)),g=await Promise.all(c);h([...n,...g])}catch(c){console.error("Error uploading images:",c),N("Failed to upload images. Please try again.")}finally{o(!1),y.current&&(y.current.value="")}}},C=async i=>{try{const c=n[i].split("/"),g=`products/${c[c.length-1]}`,{error:d}=await k.storage.from("product-images").remove([g]);d&&console.error("Error deleting image:",d);const j=n.filter((u,f)=>f!==i);h(j)}catch(a){console.error("Error removing image:",a)}},F=i=>{if(i===0)return;const a=[...n],[c]=a.splice(i,1);a.unshift(c),h(a)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-chocolate-700 font-medium mb-2",children:["Product Images",e.jsxs("span",{className:"text-sm text-chocolate-500 ml-2",children:["(Max ",m," images, up to ",v,"MB each)"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{var i;return(i=y.current)==null?void 0:i.click()},disabled:s||n.length>=m,className:"flex items-center gap-2 px-4 py-2 bg-ochre text-white rounded-lg hover:bg-ochre-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:20,className:"animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{size:20}),"Upload Images"]})}),e.jsxs("span",{className:"text-sm text-chocolate-600",children:[n.length," / ",m," images"]})]}),e.jsx("input",{ref:y,type:"file",accept:"image/*",multiple:!0,onChange:S,className:"hidden"})]}),P&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:P}),n.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:n.map((i,a)=>e.jsxs("div",{className:"relative group aspect-square bg-chocolate-50 rounded-lg overflow-hidden border-2 border-chocolate-200",children:[e.jsx("img",{src:i,alt:`Product ${a+1}`,className:"w-full h-full object-cover"}),a===0&&e.jsx("div",{className:"absolute top-2 left-2 bg-ochre text-white text-xs px-2 py-1 rounded",children:"Primary"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100",children:[a!==0&&e.jsx("button",{type:"button",onClick:()=>F(a),className:"px-3 py-1 bg-white text-chocolate-900 text-xs rounded hover:bg-chocolate-100 transition-colors",children:"Set Primary"}),e.jsx("button",{type:"button",onClick:()=>C(a),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(L,{size:16})})]})]},a))}):e.jsxs("div",{className:"border-2 border-dashed border-chocolate-300 rounded-lg p-8 text-center",children:[e.jsx(G,{size:48,className:"mx-auto text-chocolate-400 mb-2"}),e.jsx("p",{className:"text-chocolate-600",children:"No images uploaded yet"}),e.jsx("p",{className:"text-sm text-chocolate-500 mt-1",children:'Click "Upload Images" to add product photos'})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Tips:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"First image will be used as the primary product image"}),e.jsx("li",{children:"Images are automatically compressed and optimized"}),e.jsx("li",{children:"Supported formats: JPG, PNG, WebP"}),e.jsx("li",{children:'Click "Set Primary" to change the main product image'})]})]})]})},O={sku:"",name:"",title:"",description:"",short_desc:"",long_desc:"",price:0,image_url:"",images:[],category:"gud-bites",weight:"250g",stock_quantity:0,is_new:!1,is_bestseller:!1,bullets:[""],ingredients:[""],nutrition_highlights:{},alt_text:"",meta_title:"",meta_description:""};function Y(){const n=M(),{id:h}=z(),{isAdmin:m,isLoading:v}=D(),[s,o]=b.useState(O),[P,N]=b.useState(!1),[y,I]=b.useState(!1),[_,S]=b.useState(""),[C,F]=b.useState(""),i=!!h;b.useEffect(()=>{!v&&!m&&n("/")},[m,v,n]),b.useEffect(()=>{i&&m&&a()},[h,m]);const a=async()=>{if(h){N(!0);try{const{data:t,error:r}=await k.from("products").select("*").eq("id",h).single();if(r)throw r;o({sku:t.sku||"",name:t.name||"",title:t.title||"",description:t.description||"",short_desc:t.short_desc||"",long_desc:t.long_desc||"",price:t.price||0,image_url:t.image_url||"",images:t.images||(t.image_url?[t.image_url]:[]),category:t.category||"gud-bites",weight:t.weight||"250g",stock_quantity:t.stock_quantity||0,is_new:t.is_new||!1,is_bestseller:t.is_bestseller||!1,bullets:t.bullets||[""],ingredients:t.ingredients||[""],nutrition_highlights:t.nutrition_highlights||{},alt_text:t.alt_text||"",meta_title:t.meta_title||"",meta_description:t.meta_description||""})}catch(t){console.error("Error loading product:",t),alert("Failed to load product")}finally{N(!1)}}},c=async t=>{t.preventDefault(),I(!0);try{const r={...s,bullets:s.bullets.filter(l=>l.trim()),ingredients:s.ingredients.filter(l=>l.trim()),image_url:s.images.length>0?s.images[0]:s.image_url,images:s.images};if(i&&h){const{error:l}=await k.from("products").update(r).eq("id",h);if(l)throw l;alert("Product updated successfully!")}else{const{error:l}=await k.from("products").insert([r]);if(l)throw l;alert("Product created successfully!")}n("/admin/products")}catch(r){console.error("Error saving product:",r),alert(`Failed to save product: ${r.message}`)}finally{I(!1)}},g=()=>o({...s,bullets:[...s.bullets,""]}),d=t=>{o({...s,bullets:s.bullets.filter((r,l)=>l!==t)})},j=(t,r)=>{const l=[...s.bullets];l[t]=r,o({...s,bullets:l})},u=()=>o({...s,ingredients:[...s.ingredients,""]}),f=t=>{o({...s,ingredients:s.ingredients.filter((r,l)=>l!==t)})},w=(t,r)=>{const l=[...s.ingredients];l[t]=r,o({...s,ingredients:l})},x=()=>{_&&C&&(o({...s,nutrition_highlights:{...s.nutrition_highlights,[_]:C}}),S(""),F(""))},p=t=>{const r={...s.nutrition_highlights};delete r[t],o({...s,nutrition_highlights:r})};return v||P?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ochre"})}):m?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>n("/admin/products"),className:"flex items-center gap-2 text-chocolate-600 hover:text-chocolate-900 mb-4",children:[e.jsx(R,{size:20}),"Back to Products"]}),e.jsx("h1",{className:"text-3xl font-bold text-chocolate-900",children:i?"Edit Product":"Add New Product"})]}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SKU ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.sku,onChange:t=>o({...s,sku:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"MG-TIL-CL-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.category,onChange:t=>o({...s,category:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",children:[e.jsx("option",{value:"gud-bites",children:"Gud Bites"}),e.jsx("option",{value:"trial-pack",children:"Trial Pack"}),e.jsx("option",{value:"gift-sets",children:"Gift Sets"}),e.jsx("option",{value:"traditional",children:"Traditional"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.name,onChange:t=>o({...s,name:t.target.value,title:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"Classic Til-Gud Bites"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Short Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.short_desc,onChange:t=>o({...s,short_desc:t.target.value,description:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"Crispy sesame & jaggery bites made for everyday snacking"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Long Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{required:!0,rows:4,value:s.long_desc,onChange:t=>o({...s,long_desc:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"Detailed product description..."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Pricing & Inventory"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Price (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:s.price,onChange:t=>o({...s,price:parseFloat(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Stock Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",required:!0,min:"0",value:s.stock_quantity,onChange:t=>o({...s,stock_quantity:parseInt(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Weight ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.weight,onChange:t=>o({...s,weight:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"250g"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsx(V,{images:s.images,onImagesChange:t=>o({...s,images:t}),maxImages:5,maxSizeMB:2})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Feature Bullets"}),s.bullets.map((t,r)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:t,onChange:l=>j(r,l.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"Feature point..."}),e.jsx("button",{type:"button",onClick:()=>d(r),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Remove"})]},r)),e.jsx("button",{type:"button",onClick:g,className:"mt-2 px-4 py-2 bg-ochre text-white rounded-lg hover:bg-ochre-600",children:"Add Bullet"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Ingredients"}),s.ingredients.map((t,r)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:t,onChange:l=>w(r,l.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500",placeholder:"Ingredient..."}),e.jsx("button",{type:"button",onClick:()=>f(r),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Remove"})]},r)),e.jsx("button",{type:"button",onClick:u,className:"mt-2 px-4 py-2 bg-ochre text-white rounded-lg hover:bg-ochre-600",children:"Add Ingredient"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Nutrition Highlights"}),e.jsx("div",{className:"mb-4",children:Object.entries(s.nutrition_highlights).map(([t,r])=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"font-medium",children:[t,":"]}),e.jsx("span",{children:r}),e.jsx("button",{type:"button",onClick:()=>p(t),className:"ml-auto text-red-500 hover:text-red-700",children:"Remove"})]},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:_,onChange:t=>S(t.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg",placeholder:"Key (e.g., Energy)"}),e.jsx("input",{type:"text",value:C,onChange:t=>F(t.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg",placeholder:"Value (e.g., 420 kcal/100g)"}),e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 bg-ochre text-white rounded-lg hover:bg-ochre-600",children:"Add"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"SEO"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alt Text"}),e.jsx("input",{type:"text",value:s.alt_text,onChange:t=>o({...s,alt_text:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Meta Title"}),e.jsx("input",{type:"text",value:s.meta_title,onChange:t=>o({...s,meta_title:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Meta Description"}),e.jsx("textarea",{rows:2,value:s.meta_description,onChange:t=>o({...s,meta_description:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ochre-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Product Flags"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.is_new,onChange:t=>o({...s,is_new:t.target.checked}),className:"w-5 h-5 text-ochre focus:ring-ochre-500"}),e.jsx("span",{className:"text-gray-700",children:"Mark as New"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.is_bestseller,onChange:t=>o({...s,is_bestseller:t.target.checked}),className:"w-5 h-5 text-ochre focus:ring-ochre-500"}),e.jsx("span",{className:"text-gray-700",children:"Mark as Bestseller"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",disabled:y,className:"flex-1 flex items-center justify-center gap-2 bg-ochre text-white px-6 py-3 rounded-lg hover:bg-ochre-600 transition-colors disabled:opacity-50",children:y?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin",size:20}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{size:20}),i?"Update Product":"Create Product"]})}),e.jsx("button",{type:"button",onClick:()=>n("/admin/products"),className:"px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]})}):null}export{Y as default};
