import{q as Q,v as V,r,s as m,j as e,K as g,C as D}from"./index-DDPWc_ZQ.js";import{S as K}from"./search-CAyVW2CM.js";import{F as W}from"./filter-DZGSjmPs.js";import{E as X}from"./eye-Dk-gwyaQ.js";import{T as E}from"./truck-J9eVq9qq.js";import{P as F}from"./package-BRHkGikc.js";import{R as L}from"./refresh-cw-BwAPxEDS.js";import{C as A}from"./clock-YrbTxOYU.js";const te=()=>{const j=Q(),{isAdmin:b,isLoading:p}=V(),[N,P]=r.useState([]),[y,M]=r.useState([]),[T,v]=r.useState(!0),[i,U]=r.useState(""),[n,q]=r.useState("all"),[t,R]=r.useState(null),[I,h]=r.useState(!1),[d,u]=r.useState(""),[o,w]=r.useState(!1);r.useEffect(()=>{!p&&!b&&j("/")},[b,p,j]),r.useEffect(()=>{_()},[]),r.useEffect(()=>{let s=[...N];i.trim()&&(s=s.filter(a=>{var c,l;return a.order_number.toLowerCase().includes(i.toLowerCase())||((c=a.customer_name)==null?void 0:c.toLowerCase().includes(i.toLowerCase()))||((l=a.customer_email)==null?void 0:l.toLowerCase().includes(i.toLowerCase()))})),n!=="all"&&(s=s.filter(a=>a.status===n)),M(s)},[N,i,n]);const _=async()=>{try{v(!0);const{data:s,error:a}=await m.from("orders").select(`
          *,
          user_profiles!orders_user_id_fkey(full_name, email)
        `).order("created_at",{ascending:!1});if(a)throw a;const c=await Promise.all((s||[]).map(async l=>{var z,O;const{data:$}=await m.from("order_items").select("*").eq("order_id",l.id);return{...l,items:$||[],customer_name:((z=l.user_profiles)==null?void 0:z.full_name)||"Unknown",customer_email:((O=l.user_profiles)==null?void 0:O.email)||""}}));P(c)}catch(s){console.error("Error loading orders:",s),alert("Failed to load orders")}finally{v(!1)}},x=async(s,a)=>{try{w(!0);const c={status:a,updated_at:new Date().toISOString()};if(a==="shipped"&&!d.trim()){alert("Please enter a tracking number");return}a==="shipped"&&d.trim()&&(c.tracking_number=d.trim());const{error:l}=await m.from("orders").update(c).eq("id",s);if(l)throw l;await m.rpc("log_admin_activity",{p_action:"update_order_status",p_details:{order_id:s,new_status:a}}),alert("Order status updated successfully"),u(""),h(!1),_()}catch(c){console.error("Error updating order status:",c),alert("Failed to update order status")}finally{w(!1)}},C=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"refunded":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},k=s=>{switch(s){case"pending":return e.jsx(A,{size:16});case"confirmed":return e.jsx(D,{size:16});case"shipped":return e.jsx(E,{size:16});case"delivered":return e.jsx(F,{size:16});case"cancelled":return e.jsx(g,{size:16});case"refunded":return e.jsx(L,{size:16});default:return e.jsx(A,{size:16})}},S=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=s=>`â‚¹${s.toFixed(2)}`;return p||T?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ochre"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-chocolate-900 mb-2",children:"Orders Management"}),e.jsx("p",{className:"text-chocolate-600",children:"View and manage all customer orders"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-chocolate-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by order number, customer name, or email...",value:i,onChange:s=>U(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-chocolate-300 rounded-lg focus:ring-2 focus:ring-ochre focus:border-transparent"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-chocolate-400",size:20}),e.jsxs("select",{value:n,onChange:s=>q(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-chocolate-300 rounded-lg focus:ring-2 focus:ring-ochre focus:border-transparent appearance-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-chocolate-200",children:[e.jsx("thead",{className:"bg-chocolate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Order Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-chocolate-200",children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-chocolate-500",children:i||n!=="all"?"No orders found matching your filters":"No orders yet"})}):y.map(s=>e.jsxs("tr",{className:"hover:bg-chocolate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"font-medium text-chocolate-900",children:s.order_number})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-chocolate-900",children:s.customer_name}),e.jsx("div",{className:"text-sm text-chocolate-500",children:s.customer_email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-chocolate-600",children:S(s.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"font-semibold text-chocolate-900",children:f(s.total_amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold ${C(s.status)}`,children:[k(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-medium ${s.payment_status==="paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.payment_status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>{R(s),u(s.tracking_number||""),h(!0)},className:"inline-flex items-center gap-1 text-ochre hover:text-ochre-600 font-medium",children:[e.jsx(X,{size:18}),"View Details"]})})]},s.id))})]})})}),I&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-chocolate-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-chocolate-900",children:["Order ",t.order_number]}),e.jsxs("p",{className:"text-chocolate-600 mt-1",children:["Placed on ",S(t.created_at)]})]}),e.jsx("button",{onClick:()=>h(!1),className:"text-chocolate-400 hover:text-chocolate-600",children:e.jsx(g,{size:24})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-chocolate-900 mb-2",children:"Customer Information"}),e.jsxs("div",{className:"bg-chocolate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-chocolate-900 font-medium",children:t.customer_name}),e.jsx("p",{className:"text-chocolate-600",children:t.customer_email})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-chocolate-900 mb-2",children:"Shipping Address"}),e.jsx("div",{className:"bg-chocolate-50 rounded-lg p-4",children:t.shipping_address?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-chocolate-900",children:t.shipping_address.street}),e.jsxs("p",{className:"text-chocolate-900",children:[t.shipping_address.city,", ",t.shipping_address.state," ",t.shipping_address.zip]}),e.jsx("p",{className:"text-chocolate-900",children:t.shipping_address.country}),e.jsxs("p",{className:"text-chocolate-600 mt-2",children:["Phone: ",t.shipping_address.phone]})]}):e.jsx("p",{className:"text-chocolate-500",children:"No shipping address provided"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-chocolate-900 mb-2",children:"Order Items"}),e.jsx("div",{className:"space-y-3",children:t.items.map(s=>e.jsxs("div",{className:"flex items-center gap-4 bg-chocolate-50 rounded-lg p-4",children:[e.jsx("img",{src:s.image_url||"/placeholder.jpg",alt:s.product_name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-chocolate-900",children:s.product_name}),e.jsxs("p",{className:"text-sm text-chocolate-600",children:["Quantity: ",s.quantity]})]}),e.jsx("p",{className:"font-semibold text-chocolate-900",children:f(s.price*s.quantity)})]},s.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-chocolate-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-chocolate-900",children:"Total Amount:"}),e.jsx("span",{className:"text-2xl font-bold text-chocolate-900",children:f(t.total_amount)})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-chocolate-900 mb-3",children:"Update Order Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-chocolate-600",children:"Current Status:"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold ${C(t.status)}`,children:[k(t.status),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})]}),t.tracking_number&&e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-purple-900",children:[e.jsx("span",{className:"font-semibold",children:"Tracking Number:"})," ",t.tracking_number]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(t.id,"confirmed"),disabled:o,className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50",children:[e.jsx(D,{size:18}),"Confirm Order"]}),e.jsxs("button",{onClick:()=>x(t.id,"cancelled"),disabled:o,className:"flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 disabled:opacity-50",children:[e.jsx(g,{size:18}),"Cancel Order"]})]}),t.status==="confirmed"&&e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Enter tracking number",value:d,onChange:s=>u(s.target.value),className:"w-full px-4 py-2 border border-chocolate-300 rounded-lg focus:ring-2 focus:ring-ochre focus:border-transparent"}),e.jsxs("button",{onClick:()=>x(t.id,"shipped"),disabled:o||!d.trim(),className:"flex items-center gap-2 bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 disabled:opacity-50",children:[e.jsx(E,{size:18}),"Mark as Shipped"]})]}),t.status==="shipped"&&e.jsxs("button",{onClick:()=>x(t.id,"delivered"),disabled:o,className:"flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 disabled:opacity-50",children:[e.jsx(F,{size:18}),"Mark as Delivered"]}),(t.status==="delivered"||t.status==="cancelled")&&e.jsxs("button",{onClick:()=>x(t.id,"refunded"),disabled:o,className:"flex items-center gap-2 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 disabled:opacity-50",children:[e.jsx(L,{size:18}),"Mark as Refunded"]})]})]})]})]})]})})]})};export{te as default};
