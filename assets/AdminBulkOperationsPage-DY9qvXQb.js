import{c as ue,q as me,v as be,r as c,s as p,j as e,g as fe,A as ge}from"./index-DDPWc_ZQ.js";import{P as je}from"./package-BRHkGikc.js";import{U as L}from"./upload-CZVShtMT.js";import{R as Y}from"./refresh-cw-BwAPxEDS.js";import{D as Z}from"./download-M3bti4Cr.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=ue("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),Se=()=>{const R=me(),{isAdmin:V,isLoading:B}=be(),[d,y]=c.useState("products"),[x,te]=c.useState([]),[u,se]=c.useState([]),[o,k]=c.useState(new Set),[i,S]=c.useState(new Set),[le,C]=c.useState(!0),[m,b]=c.useState(!1),[g,T]=c.useState(0),[_,ae]=c.useState("set"),[j,q]=c.useState(0),[z,ce]=c.useState("set"),[P,M]=c.useState(null),[O,H]=c.useState(null),[f,K]=c.useState(""),[E,G]=c.useState(null),[A,J]=c.useState([]);c.useEffect(()=>{!B&&!V&&R("/")},[V,B,R]),c.useEffect(()=>{d==="products"?I():d==="orders"&&Q()},[d]);const I=async()=>{try{C(!0);const{data:t,error:s}=await p.from("products").select("id, sku, name, stock, price, is_new, is_bestseller").order("name");if(s)throw s;te(t||[])}catch(t){console.error("Error loading products:",t),alert("Failed to load products")}finally{C(!1)}},Q=async()=>{try{C(!0);const{data:t,error:s}=await p.from("orders").select("id, order_number, status, created_at").order("created_at",{ascending:!1}).limit(100);if(s)throw s;se(t||[])}catch(t){console.error("Error loading orders:",t),alert("Failed to load orders")}finally{C(!1)}},re=t=>{const s=new Set(o);s.has(t)?s.delete(t):s.add(t),k(s)},W=()=>{o.size===x.length?k(new Set):k(new Set(x.map(t=>t.id)))},oe=t=>{const s=new Set(i);s.has(t)?s.delete(t):s.add(t),S(s)},X=()=>{i.size===u.length?S(new Set):S(new Set(u.map(t=>t.id)))},ie=async()=>{if(o.size===0){alert("Please select at least one product");return}if(confirm(`Update ${o.size} product(s)?`))try{b(!0);for(const t of o){const s=x.find(a=>a.id===t);if(!s)continue;const l={};if(g!==0||_==="set")switch(_){case"set":l.stock=g;break;case"add":l.stock=s.stock+g;break;case"subtract":l.stock=Math.max(0,s.stock-g);break}if(j!==0||z==="set")switch(z){case"set":l.price=j;break;case"increase":l.price=s.price+j;break;case"decrease":l.price=Math.max(0,s.price-j);break}if(P!==null&&(l.is_new=P),O!==null&&(l.is_bestseller=O),Object.keys(l).length>0){const{error:a}=await p.from("products").update(l).eq("id",t);if(a)throw a}}await p.rpc("log_admin_activity",{p_action:"bulk_update_products",p_details:{count:o.size,updates:{bulkStockOperation:_,bulkPriceOperation:z}}}),alert(`Successfully updated ${o.size} product(s)`),k(new Set),I(),T(0),q(0),M(null),H(null)}catch(t){console.error("Error updating products:",t),alert("Failed to update products")}finally{b(!1)}},ne=async()=>{if(i.size===0){alert("Please select at least one order");return}if(!f){alert("Please select a status");return}if(confirm(`Update ${i.size} order(s) to ${f}?`))try{b(!0);for(const t of i){const{error:s}=await p.from("orders").update({status:f,updated_at:new Date().toISOString()}).eq("id",t);if(s)throw s}await p.rpc("log_admin_activity",{p_action:"bulk_update_orders",p_details:{count:i.size,status:f}}),alert(`Successfully updated ${i.size} order(s)`),S(new Set),Q(),K("")}catch(t){console.error("Error updating orders:",t),alert("Failed to update orders")}finally{b(!1)}},de=t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];if(!s)return;G(s);const l=new FileReader;l.onload=n=>{var r;const v=((r=n.target)==null?void 0:r.result).split(`
`),h=v[0].split(",").map(N=>N.trim()),$=v.slice(1,6).map(N=>{const w=N.split(",").map(D=>D.trim()),U={};return h.forEach((D,pe)=>{U[D]=w[pe]}),U});J($)},l.readAsText(s)},xe=async()=>{if(!E){alert("Please select a CSV file");return}if(confirm("Import products from CSV? This will create new products."))try{b(!0);const t=new FileReader;t.onload=async s=>{var v;const a=((v=s.target)==null?void 0:v.result).split(`
`),n=a[0].split(",").map(h=>h.trim());let F=0;for(let h=1;h<a.length;h++){if(!a[h].trim())continue;const $=a[h].split(",").map(w=>w.trim()),r={};n.forEach((w,U)=>{r[w]=$[U]}),r.price&&(r.price=parseFloat(r.price)),r.stock&&(r.stock=parseInt(r.stock)),r.is_new&&(r.is_new=r.is_new.toLowerCase()==="true"),r.is_bestseller&&(r.is_bestseller=r.is_bestseller.toLowerCase()==="true");const{error:N}=await p.from("products").insert(r);N||F++}await p.rpc("log_admin_activity",{p_action:"import_products_csv",p_details:{count:F}}),alert(`Successfully imported ${F} product(s)`),G(null),J([]),y("products"),I()},t.readAsText(E)}catch(t){console.error("Error importing CSV:",t),alert("Failed to import CSV")}finally{b(!1)}},he=async()=>{try{const t=[["sku","name","price","stock","category","is_new","is_bestseller"],...x.map(n=>[n.sku,n.name,n.price.toString(),n.stock.toString(),"",n.is_new.toString(),n.is_bestseller.toString()])].map(n=>n.join(",")).join(`
`),s=new Blob([t],{type:"text/csv"}),l=window.URL.createObjectURL(s),a=document.createElement("a");a.href=l,a.download=`products-export-${new Date().toISOString().split("T")[0]}.csv`,a.click(),window.URL.revokeObjectURL(l)}catch(t){console.error("Error exporting CSV:",t),alert("Failed to export CSV")}};return B||le?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ochre"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-chocolate-900 mb-2",children:"Bulk Operations"}),e.jsx("p",{className:"text-chocolate-600",children:"Perform bulk actions on products and orders"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md mb-6",children:e.jsxs("div",{className:"flex border-b border-chocolate-200",children:[e.jsxs("button",{onClick:()=>y("products"),className:`flex items-center gap-2 px-6 py-4 font-medium transition-colors ${d==="products"?"border-b-2 border-ochre text-ochre":"text-chocolate-600 hover:text-chocolate-900"}`,children:[e.jsx(je,{size:20}),"Products (",o.size," selected)"]}),e.jsxs("button",{onClick:()=>y("orders"),className:`flex items-center gap-2 px-6 py-4 font-medium transition-colors ${d==="orders"?"border-b-2 border-ochre text-ochre":"text-chocolate-600 hover:text-chocolate-900"}`,children:[e.jsx(fe,{size:20}),"Orders (",i.size," selected)"]}),e.jsxs("button",{onClick:()=>y("import"),className:`flex items-center gap-2 px-6 py-4 font-medium transition-colors ${d==="import"?"border-b-2 border-ochre text-ochre":"text-chocolate-600 hover:text-chocolate-900"}`,children:[e.jsx(L,{size:20}),"Import/Export"]})]})}),d==="products"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Bulk Update Products"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-chocolate-700 font-medium mb-2",children:"Stock Update"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:_,onChange:t=>ae(t.target.value),className:"px-4 py-2 border border-chocolate-300 rounded-lg",children:[e.jsx("option",{value:"set",children:"Set to"}),e.jsx("option",{value:"add",children:"Add"}),e.jsx("option",{value:"subtract",children:"Subtract"})]}),e.jsx("input",{type:"number",value:g,onChange:t=>T(parseInt(t.target.value)||0),className:"flex-1 px-4 py-2 border border-chocolate-300 rounded-lg",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-chocolate-700 font-medium mb-2",children:"Price Update (₹)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:z,onChange:t=>ce(t.target.value),className:"px-4 py-2 border border-chocolate-300 rounded-lg",children:[e.jsx("option",{value:"set",children:"Set to"}),e.jsx("option",{value:"increase",children:"Increase by"}),e.jsx("option",{value:"decrease",children:"Decrease by"})]}),e.jsx("input",{type:"number",step:"0.01",value:j,onChange:t=>q(parseFloat(t.target.value)||0),className:"flex-1 px-4 py-2 border border-chocolate-300 rounded-lg",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-chocolate-700 font-medium mb-2",children:"New Product Flag"}),e.jsxs("select",{value:P===null?"":P.toString(),onChange:t=>M(t.target.value===""?null:t.target.value==="true"),className:"w-full px-4 py-2 border border-chocolate-300 rounded-lg",children:[e.jsx("option",{value:"",children:"No change"}),e.jsx("option",{value:"true",children:"Mark as New"}),e.jsx("option",{value:"false",children:"Remove New Flag"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-chocolate-700 font-medium mb-2",children:"Bestseller Flag"}),e.jsxs("select",{value:O===null?"":O.toString(),onChange:t=>H(t.target.value===""?null:t.target.value==="true"),className:"w-full px-4 py-2 border border-chocolate-300 rounded-lg",children:[e.jsx("option",{value:"",children:"No change"}),e.jsx("option",{value:"true",children:"Mark as Bestseller"}),e.jsx("option",{value:"false",children:"Remove Bestseller Flag"})]})]})]}),e.jsxs("button",{onClick:ie,disabled:m||o.size===0,className:"mt-4 flex items-center gap-2 bg-ochre text-white px-6 py-3 rounded-lg hover:bg-ochre-600 transition-colors disabled:opacity-50",children:[e.jsx(Y,{size:20}),m?"Updating...":`Update ${o.size} Product(s)`]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-chocolate-200 flex justify-between items-center",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 text-ochre hover:text-ochre-600",children:[e.jsx(ee,{size:20}),o.size===x.length?"Deselect All":"Select All"]}),e.jsxs("span",{className:"text-chocolate-600",children:[x.length," products"]})]}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-chocolate-200",children:[e.jsx("thead",{className:"bg-chocolate-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:o.size===x.length&&x.length>0,onChange:W,className:"w-4 h-4"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Flags"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-chocolate-200",children:x.map(t=>e.jsxs("tr",{className:"hover:bg-chocolate-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:o.has(t.id),onChange:()=>re(t.id),className:"w-4 h-4"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-chocolate-900",children:t.sku}),e.jsx("td",{className:"px-6 py-4 text-sm text-chocolate-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-chocolate-900",children:t.stock}),e.jsxs("td",{className:"px-6 py-4 text-sm text-chocolate-900",children:["₹",t.price]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[t.is_new&&e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-1",children:"New"}),t.is_bestseller&&e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"Bestseller"})]})]},t.id))})]})})]})]}),d==="orders"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-chocolate-900 mb-4",children:"Bulk Update Orders"}),e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-chocolate-700 font-medium mb-2",children:"Change Status To"}),e.jsxs("select",{value:f,onChange:t=>K(t.target.value),className:"w-full px-4 py-2 border border-chocolate-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Select status..."}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("button",{onClick:ne,disabled:m||i.size===0||!f,className:"flex items-center gap-2 bg-ochre text-white px-6 py-3 rounded-lg hover:bg-ochre-600 transition-colors disabled:opacity-50",children:[e.jsx(Y,{size:20}),m?"Updating...":`Update ${i.size} Order(s)`]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-chocolate-200 flex justify-between items-center",children:[e.jsxs("button",{onClick:X,className:"flex items-center gap-2 text-ochre hover:text-ochre-600",children:[e.jsx(ee,{size:20}),i.size===u.length?"Deselect All":"Select All"]}),e.jsxs("span",{className:"text-chocolate-600",children:[u.length," orders"]})]}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-chocolate-200",children:[e.jsx("thead",{className:"bg-chocolate-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:i.size===u.length&&u.length>0,onChange:X,className:"w-4 h-4"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Order Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-chocolate-700 uppercase",children:"Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-chocolate-200",children:u.map(t=>e.jsxs("tr",{className:"hover:bg-chocolate-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:i.has(t.id),onChange:()=>oe(t.id),className:"w-4 h-4"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-chocolate-900 font-medium",children:t.order_number}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="delivered"?"bg-green-100 text-green-800":t.status==="shipped"?"bg-purple-100 text-purple-800":t.status==="confirmed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-chocolate-600",children:new Date(t.created_at).toLocaleDateString()})]},t.id))})]})})]})]}),d==="import"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-chocolate-900 mb-4 flex items-center gap-2",children:[e.jsx(Z,{size:20}),"Export Products"]}),e.jsx("p",{className:"text-chocolate-600 mb-4",children:"Download all products as CSV file"}),e.jsxs("button",{onClick:he,className:"flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Z,{size:20}),"Export Products CSV"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-chocolate-900 mb-4 flex items-center gap-2",children:[e.jsx(L,{size:20}),"Import Products"]}),e.jsx("p",{className:"text-chocolate-600 mb-4",children:"Upload CSV file to import products"}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ge,{size:20,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"CSV Format"}),e.jsx("p",{className:"text-sm",children:"Required columns: sku, name, price, stock"}),e.jsx("p",{className:"text-sm",children:"Optional: category, is_new, is_bestseller"})]})]})}),e.jsx("input",{type:"file",accept:".csv",onChange:de,className:"block w-full text-sm text-chocolate-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-ochre-50 file:text-ochre hover:file:bg-ochre-100 mb-4"}),A.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-chocolate-900 mb-2",children:"Preview (first 5 rows)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-chocolate-200",children:[e.jsx("thead",{className:"bg-chocolate-50",children:e.jsx("tr",{children:Object.keys(A[0]).map(t=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-chocolate-700 uppercase",children:t},t))})}),e.jsx("tbody",{className:"bg-white divide-y divide-chocolate-200",children:A.map((t,s)=>e.jsx("tr",{children:Object.values(t).map((l,a)=>e.jsx("td",{className:"px-4 py-2 text-sm text-chocolate-900",children:l},a))},s))})]})})]}),e.jsxs("button",{onClick:xe,disabled:!E||m,className:"flex items-center gap-2 bg-ochre text-white px-6 py-3 rounded-lg hover:bg-ochre-600 transition-colors disabled:opacity-50",children:[e.jsx(L,{size:20}),m?"Importing...":"Import CSV"]})]})]})]})};export{Se as default};
