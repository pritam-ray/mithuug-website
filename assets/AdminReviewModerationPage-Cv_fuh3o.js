import{r as c,N as _,s as m,j as e,y as j,X as S,T as C}from"./index-DDPWc_ZQ.js";import{S as R}from"./SEO-BeZmPqYZ.js";import{S as A}from"./search-CAyVW2CM.js";import{F as L}from"./filter-DZGSjmPs.js";import{E as z}from"./eye-Dk-gwyaQ.js";import{S as k}from"./star-B8AD6aH5.js";const D=()=>{const[h,v]=c.useState([]),[N,p]=c.useState(!0),[a,n]=c.useState("all"),[i,y]=c.useState(""),{showToast:l}=_();c.useEffect(()=>{d()},[a]);const d=async()=>{try{p(!0);let s=m.from("reviews").select(`
          *,
          products (name),
          users:user_id (email)
        `).order("created_at",{ascending:!1});a==="pending"?s=s.eq("is_approved",!1):a==="approved"&&(s=s.eq("is_approved",!0));const{data:t,error:r}=await s;if(r)throw r;const o=(t==null?void 0:t.map(x=>{var f,b;return{...x,product_name:(f=x.products)==null?void 0:f.name,user_email:(b=x.users)==null?void 0:b.email}}))||[];v(o)}catch(s){l("error",s.message)}finally{p(!1)}},u=async(s,t,r)=>{try{const{error:o}=await m.from("reviews").update({is_approved:t,admin_notes:r||null}).eq("id",s);if(o)throw o;l("success",`Review ${t?"approved":"rejected"}`),d()}catch(o){l("error",o.message)}},w=async s=>{if(confirm("Are you sure you want to delete this review? This action cannot be undone."))try{const{error:t}=await m.from("reviews").delete().eq("id",s);if(t)throw t;l("success","Review deleted"),d()}catch(t){l("error",t.message)}},g=h.filter(s=>{var r,o;if(!i)return!0;const t=i.toLowerCase();return s.title.toLowerCase().includes(t)||s.comment.toLowerCase().includes(t)||((r=s.product_name)==null?void 0:r.toLowerCase().includes(t))||((o=s.user_email)==null?void 0:o.toLowerCase().includes(t))});return e.jsxs("div",{className:"min-h-screen pt-20 bg-ivory",children:[e.jsx(R,{title:"Review Moderation - Admin - MitthuuG",description:"Moderate customer reviews"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-12",children:[e.jsx("h1",{className:"text-4xl font-playfair font-bold text-chocolate-900 mb-8",children:"Review Moderation"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(A,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-chocolate-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search reviews...",value:i,onChange:s=>y(s.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-chocolate-200 rounded-lg focus:border-ochre focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>n("all"),className:`flex items-center gap-2 px-6 py-3 rounded-lg border-2 transition-colors ${a==="all"?"bg-ochre text-white border-ochre":"bg-white text-chocolate-600 border-chocolate-200 hover:border-ochre"}`,children:[e.jsx(L,{size:20}),"All (",h.length,")"]}),e.jsxs("button",{onClick:()=>n("pending"),className:`flex items-center gap-2 px-6 py-3 rounded-lg border-2 transition-colors ${a==="pending"?"bg-ochre text-white border-ochre":"bg-white text-chocolate-600 border-chocolate-200 hover:border-ochre"}`,children:[e.jsx(z,{size:20}),"Pending"]}),e.jsxs("button",{onClick:()=>n("approved"),className:`flex items-center gap-2 px-6 py-3 rounded-lg border-2 transition-colors ${a==="approved"?"bg-ochre text-white border-ochre":"bg-white text-chocolate-600 border-chocolate-200 hover:border-ochre"}`,children:[e.jsx(j,{size:20}),"Approved"]})]})]}),N?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-ochre mx-auto"}),e.jsx("p",{className:"mt-4 text-chocolate-600",children:"Loading reviews..."})]}):g.length===0?e.jsx("div",{className:"text-center py-16 bg-white rounded-2xl",children:e.jsx("p",{className:"text-chocolate-600",children:"No reviews found"})}):e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsx("div",{className:"bg-white rounded-xl p-6 border-2 border-chocolate-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((t,r)=>e.jsx(k,{size:18,className:r<s.rating?"fill-gold text-gold":"text-chocolate-300"},r))}),s.verified_purchase&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-semibold",children:"Verified Purchase"}),!s.is_approved&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full font-semibold",children:"Pending Approval"})]}),e.jsx("h3",{className:"text-lg font-bold text-chocolate-900 mb-2",children:s.title}),e.jsx("p",{className:"text-chocolate-700 mb-3",children:s.comment}),s.images&&s.images.length>0&&e.jsx("div",{className:"flex gap-2 mb-3",children:s.images.map((t,r)=>e.jsx("img",{src:t,alt:`Review ${r+1}`,className:"w-20 h-20 object-cover rounded-lg border border-chocolate-200"},r))}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-chocolate-600",children:[e.jsxs("span",{children:["Product: ",e.jsx("strong",{children:s.product_name})]}),e.jsxs("span",{children:["User: ",e.jsx("strong",{children:s.user_email})]}),e.jsxs("span",{children:["Helpful: ",e.jsx("strong",{children:s.helpful_count})]}),e.jsxs("span",{children:["Posted: ",e.jsx("strong",{children:new Date(s.created_at).toLocaleDateString()})]})]}),s.admin_notes&&e.jsx("div",{className:"mt-3 p-3 bg-chocolate-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-chocolate-600",children:[e.jsx("strong",{children:"Admin Notes:"})," ",s.admin_notes]})})]}),e.jsxs("div",{className:"flex md:flex-col gap-2",children:[!s.is_approved&&e.jsxs("button",{onClick:()=>u(s.id,!0),className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",title:"Approve",children:[e.jsx(j,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Approve"})]}),s.is_approved&&e.jsxs("button",{onClick:()=>u(s.id,!1,"Unapproved by admin"),className:"flex items-center gap-2 px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors",title:"Unapprove",children:[e.jsx(S,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Unapprove"})]}),e.jsxs("button",{onClick:()=>w(s.id),className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Delete",children:[e.jsx(C,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Delete"})]})]})]})},s.id))})]})]})};export{D as default};
